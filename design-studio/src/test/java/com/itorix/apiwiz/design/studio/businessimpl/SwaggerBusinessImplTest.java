package com.itorix.apiwiz.design.studio.businessimpl;


import com.itorix.apiwiz.design.studio.model.Revision;
import com.itorix.apiwiz.design.studio.model.Swagger3VO;
import com.itorix.apiwiz.identitymanagement.dao.BaseRepository;
import org.junit.Before;
import org.junit.Test;
import static org.junit.Assert.*;
import static org.mockito.Mockito.*;

import org.mockito.InjectMocks;
import org.mockito.Mock;
import org.mockito.Mockito.*;
import org.mockito.MockitoAnnotations;
import com.fasterxml.jackson.databind.node.ObjectNode;

import java.util.ArrayList;
import java.util.Map;

public class SwaggerBusinessImplTest {

    @InjectMocks
    SwaggerBusinessImpl swaggerBusiness = new SwaggerBusinessImpl();

    @Mock
    BaseRepository baseRepository;

    @Before
    public void setupMock() {
        MockitoAnnotations.initMocks(this);
    }

    @Test
    public void getSwaggerInfoForSwagger3() {
        String oas= "3.0";
        String swaggerId = "0af476b3d44447bcbcfb9f0f0459963d";
        String jsessionId = "1234";

        Swagger3VO swagger3VO = spy(new Swagger3VO());
        String swaggerName = "Test";
        swagger3VO.setName(swaggerName);
        swagger3VO.setSwagger("{\"openapi\":\"3.0.0\",\"info\":{\"title\":\"EDI Benefit Eligibility Inquiry\",\"description\":\"The EDI 270 Health Care Eligibility/Benefit Inquiry transaction set is used to request information from a healthcare insurance plan about a policyâ€™s coverages, typically in relation to a particular plan subscriber. This transaction is typically sent by healthcare service providers, such as hospitals or medical facilities, and sent to insurance companies, government agencies like Medicare or Medicaid, or other organizations that would have information about a given policy. The 270 transaction is used for inquiries about what services are covered for particular patients (policy subscribers or their dependents), including required copay or coinsurance. It may be used to inquire about general information on coverage and benefits. It may also be used for questions about the coverage of specific benefits for a given plan, such as wheelchair rental, diagnostic lab services, physical therapy services, etc. The 270 document typically includes the following:\\n\\n1. Details of the sender of the inquiry (name and contact information of the information receiver)\\n2. Name of the recipient of the inquiry (the information source)\\n3. Details of the plan subscriber about to the inquiry is referring\\n4. Description of eligibility or benefit information requested\",\"version\":\"v1.0.0\",\"termsOfService\":\"https://acme.com/terms-and-conditions\",\"license\":{\"name\":\"Acme EDI License\",\"url\":\"https://acme.com/license\"},\"contact\":{\"name\":\"Thomas Hart\",\"url\":\"https://acme.com/contact-us\",\"email\":\"thomas@acme.com\"}},\"paths\":{\"/benefit-inquiry\":{\"parameters\":[{\"name\":\"Authorization\",\"in\":\"header\",\"required\":true,\"description\":\"\",\"schema\":{\"type\":\"string\"}}],\"post\":{\"summary\":\"Use the Eligibility and Benefit Inquiry (270) transaction to inquire about the health care eligibility and benefits associated with a subscriber or dependent.\",\"description\":\"Use the Eligibility and Benefit Inquiry (270) transaction to inquire about the health care eligibility and benefits associated with a subscriber or dependent.\",\"parameters\":[{\"x-key\":1,\"name\":\"x-senderId\",\"in\":\"header\",\"required\":true,\"description\":\"Sender ID of the client application making the request.\",\"schema\":{\"type\":\"string\"}},{\"x-key\":2,\"name\":\"x-receiverId\",\"in\":\"header\",\"required\":true,\"description\":\"Receiver ID of the client application making the request.\",\"schema\":{\"type\":\"string\"}},{\"x-key\":3,\"name\":\"Content-Type\",\"in\":\"header\",\"required\":true,\"description\":\"Media type of the request payload\",\"example\":\"\",\"schema\":{\"type\":\"string\",\"default\":\"application/json\"}},{\"x-key\":4,\"name\":\"Accept\",\"in\":\"header\",\"required\":false,\"description\":\"Response media type\",\"schema\":{\"type\":\"string\",\"default\":\"application/json\"}}],\"requestBody\":{\"content\":{\"application/json\":{\"schema\":{\"$ref\":\"#/components/schemas/eligibiltyRequestModel\"}}},\"description\":\"Use the Claim Status Inquiry (276) transaction to inquire about the status of a claim after it has been sent to a payer, whether submitted on paper or electronically.\",\"required\":true,\"x-examples\":{\"application/json\":{\"payloadType\":\"X12_276_Request_005010X279A1\",\"processingMode\":\"RealTime\",\"payloadId\":\"e51d4fae-7dec-11d0-a866-00a0c91e6da2\",\"timestamp\":\"2018-06-15T15:35:45+03:00\",\"payload\":\"ISA*00*          *00*          *ZZ*AVAILITY       *ZZ*BEACON963116116*210122*2010*^*00501*000003100*0*P*:~GS*HR*AVAILITY*BEACON963116116*20210122*2010*1*X*005010X212~ST*276*0001*005010X212~BHT*0010*13*23749464748*20210122*121008~HL*1**20*1~NM1*PR*2*AVAILITY CLEARINGHOUSE*****PI*BHOVO~HL*2*1*21*1~NM1*41*2*REALMED CORPORATION*****46*S00086~HL*3*2*19*1~NM1*1P*2*MONTEFIORE NYACK HOSPITAL*****XX*1104808062~HL*4*3*22*0~DMG*D8*19690411*M~NM1*IL*1*HARTE*JAMES****MI*K9055514802~TRN*1*123456789~REF*1K*499380E0E36B45A7A230516B740BB0FE00000441~REF*D9*23749464748~AMT*T3*323~DTP*472*RD8*20210118-20210118~SE*17*0001~GE*1*1~IEA*1*000003100~\"}}},\"operationId\":\"benefit-inquiry\",\"responses\":{\"200\":{\"description\":\"The Eligibility and Benefit Response (271) transaction is used to respond to a request inquiry about the health care eligibility and benefits associated with a subscriber or dependent.\",\"headers\":{\"Content-Type\":{\"description\":\"\",\"schema\":{\"type\":\"string\",\"default\":\"application/json\"}}},\"content\":{\"application/json\":{\"schema\":{\"$ref\":\"#/components/schemas/eligibiltyResponseModel\"},\"examples\":{\"response\":{\"value\":{\"payloadType\":\"X12_276_Request_005010X279A1\",\"processingMode\":\"RealTime\",\"payloadId\":\"e51d4fae-7dec-11d0-a866-00a0c91e6da2\",\"timestamp\":\"2018-06-15T15:35:45+03:00\",\"senderId\":\"PRACINSI\",\"receiverId\":\"BHO-541414194\",\"payload\":\"ISA*00*          *00*          *ZZ*AVAILITY       *ZZ*BEACON963116116*210122*2010*^*00501*000003100*0*P*:~GS*HR*AVAILITY*BEACON963116116*20210122*2010*1*X*005010X212~ST*276*0001*005010X212~BHT*0010*13*23749464748*20210122*121008~HL*1**20*1~NM1*PR*2*AVAILITY CLEARINGHOUSE*****PI*BHOVO~HL*2*1*21*1~NM1*41*2*REALMED CORPORATION*****46*S00086~HL*3*2*19*1~NM1*1P*2*MONTEFIORE NYACK HOSPITAL*****XX*1104808062~HL*4*3*22*0~DMG*D8*19690411*M~NM1*IL*1*HARTE*JAMES****MI*K9055514802~TRN*1*123456789~REF*1K*499380E0E36B45A7A230516B740BB0FE00000441~REF*D9*23749464748~AMT*T3*323~DTP*472*RD8*20210118-20210118~SE*17*0001~GE*1*1~IEA*1*000003100~\"}}}},\"application/xml\":{\"schema\":{\"$ref\":\"#/components/schemas/eligibiltyResponseModel\"}},\"text/xml\":{\"schema\":{\"$ref\":\"#/components/schemas/eligibiltyResponseModel\"}}}},\"400\":{\"description\":\"The request could not be understood by the server due to malformed syntax. The client SHOULD NOT repeat the request without modifications.\",\"content\":{\"application/json\":{\"schema\":{\"$ref\":\"#/components/schemas/errorSchema\"}},\"application/xml\":{\"schema\":{\"$ref\":\"#/components/schemas/errorSchema\"}},\"text/xml\":{\"schema\":{\"$ref\":\"#/components/schemas/errorSchema\"}}}},\"401\":{\"description\":\"The request requires user authentication.\",\"content\":{\"application/json\":{\"schema\":{\"$ref\":\"#/components/schemas/errorSchema\"}},\"application/xml\":{\"schema\":{\"$ref\":\"#/components/schemas/errorSchema\"}},\"text/xml\":{\"schema\":{\"$ref\":\"#/components/schemas/errorSchema\"}}}},\"403\":{\"description\":\"The server understood the request, but is refusing to fulfill it. Authorization will not help and the request SHOULD NOT be repeated.\",\"content\":{\"application/json\":{\"schema\":{\"$ref\":\"#/components/schemas/errorSchema\"}},\"application/xml\":{\"schema\":{\"$ref\":\"#/components/schemas/errorSchema\"}},\"text/xml\":{\"schema\":{\"$ref\":\"#/components/schemas/errorSchema\"}}}},\"404\":{\"description\":\"The server has not found anything matching the Request-URI. No indication is given of whether the condition is temporary or permanent.\",\"content\":{\"application/json\":{\"schema\":{\"$ref\":\"#/components/schemas/errorSchema\"}},\"application/xml\":{\"schema\":{\"$ref\":\"#/components/schemas/errorSchema\"}},\"text/xml\":{\"schema\":{\"$ref\":\"#/components/schemas/errorSchema\"}}}},\"405\":{\"description\":\"The method specified in the Request-Line is not allowed for the resource identified by the Request-URI. The response MUST include an Allow header containing a list of valid methods for the requested resource.\",\"content\":{\"application/json\":{\"schema\":{\"$ref\":\"#/components/schemas/errorSchema\"}},\"application/xml\":{\"schema\":{\"$ref\":\"#/components/schemas/errorSchema\"}},\"text/xml\":{\"schema\":{\"$ref\":\"#/components/schemas/errorSchema\"}}}},\"406\":{\"description\":\"The resource identified by the request is only capable of generating response entities which have content characteristics not acceptable according to the accept headers sent in the request.\",\"content\":{\"application/json\":{\"schema\":{\"$ref\":\"#/components/schemas/errorSchema\"}},\"application/xml\":{\"schema\":{\"$ref\":\"#/components/schemas/errorSchema\"}},\"text/xml\":{\"schema\":{\"$ref\":\"#/components/schemas/errorSchema\"}}}},\"429\":{\"description\":\"Request quota settings limit\",\"content\":{\"application/json\":{\"schema\":{\"$ref\":\"#/components/schemas/errorSchema\"}},\"application/xml\":{\"schema\":{\"$ref\":\"#/components/schemas/errorSchema\"}},\"text/xml\":{\"schema\":{\"$ref\":\"#/components/schemas/errorSchema\"}}}},\"500\":{\"description\":\"The server encountered an unexpected condition which prevented it from fulfilling the request.\",\"content\":{\"application/json\":{\"schema\":{\"$ref\":\"#/components/schemas/errorSchema\"}},\"application/xml\":{\"schema\":{\"$ref\":\"#/components/schemas/errorSchema\"}},\"text/xml\":{\"schema\":{\"$ref\":\"#/components/schemas/errorSchema\"}}}},\"501\":{\"description\":\"The server does not support the functionality required to fulfill the request. This is the appropriate response when the server does not recognize the request method and is not capable of supporting it for any resource.\",\"content\":{\"application/json\":{\"schema\":{\"$ref\":\"#/components/schemas/errorSchema\"}},\"application/xml\":{\"schema\":{\"$ref\":\"#/components/schemas/errorSchema\"}},\"text/xml\":{\"schema\":{\"$ref\":\"#/components/schemas/errorSchema\"}}}},\"503\":{\"description\":\"The server is currently unable to handle the request due to a temporary overloading or maintenance of the server.\",\"content\":{\"application/json\":{\"schema\":{\"$ref\":\"#/components/schemas/errorSchema\"}},\"application/xml\":{\"schema\":{\"$ref\":\"#/components/schemas/errorSchema\"}},\"text/xml\":{\"schema\":{\"$ref\":\"#/components/schemas/errorSchema\"}}}},\"504\":{\"description\":\"The server, while acting as a gateway or proxy, did not receive a timely response from the upstream server specified by the URI (e.g. HTTP, FTP, LDAP) or some other auxiliary server (e.g. DNS) it needed to access in attempting to complete the request.\",\"content\":{\"application/json\":{\"schema\":{\"$ref\":\"#/components/schemas/errorSchema\"}},\"application/xml\":{\"schema\":{\"$ref\":\"#/components/schemas/errorSchema\"}},\"text/xml\":{\"schema\":{\"$ref\":\"#/components/schemas/errorSchema\"}}}}},\"tags\":[\"Eligibility\"],\"security\":[{\"oauth2\":[\"read\",\"write\",\"update\",\"delete\"]}]},\"description\":\"Use the Eligibility and Benefit Inquiry (270) transaction to inquire about the health care eligibility and benefits associated with a subscriber or dependent.\"}},\"tags\":[{\"name\":\"Eligibility\",\"description\":\"EDI 270/271 - Eligibility and Benefit Inquiry and Response.\"}],\"x-mock\":true,\"x-metadata\":{\"metadata\":{\"swaggerName\":\"dad42a4048a34eb7b9f1cdc7b992887a\",\"revision\":1,\"documentation\":[],\"category\":[{\"name\":\"Unsorted\",\"paths\":[\"/benefit-inquiry\"]}]}},\"security\":[{\"oauth2\":[\"read\",\"write\",\"update\",\"delete\"]}],\"servers\":[{\"description\":\"Sandbox Server\",\"url\":\"https://sandbox.acme.com/\",\"x-name\":\"Server1\"},{\"description\":\"Development Server\",\"url\":\"https://dev.acme.com/\",\"x-name\":\"Server2\"},{\"description\":\"QAT Server\",\"url\":\"https://qat.acme.com/\",\"x-name\":\"Server3\"},{\"description\":\"Production Server\",\"url\":\"https://api.acme.com/\",\"x-name\":\"Server4\"}],\"components\":{\"securitySchemes\":{\"oauth2\":{\"type\":\"oauth2\",\"description\":\"The Client Credentials grant is used when applications request an access token to access their own resources, not on behalf of a user.\",\"flows\":{\"clientCredentials\":{\"tokenUrl\":\"https://api.acme.com/v1/access/token\",\"scopes\":{\"read\":\"Allow read scope\",\"write\":\"Allow write scope\",\"update\":\"Allow update scope\",\"delete\":\"Allow delete scope\"}}}}},\"schemas\":{\"errorSchema\":{\"description\":\"Container to hold error data model for X12 transactions\",\"type\":\"object\",\"required\":[\"errors\"],\"properties\":{\"errors\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"properties\":{\"code\":{\"type\":\"string\",\"example\":\"Security-1001\"},\"userMessage\":{\"type\":\"string\",\"example\":\"Invalid Access Token\"},\"info\":{\"type\":\"string\",\"example\":\"https://developers.myapi.com/errors/#Security-1001\"}}}}}},\"eligibiltyRequestModel\":{\"description\":\"This API is designed to assist those who request reviews (specialty care, treatment, admission) and those who respond to those requests using the 278 format.\",\"properties\":{\"payloadType\":{\"type\":\"string\",\"description\":\"Paylaod type of EDI X12 request\"},\"processingMode\":{\"type\":\"string\",\"description\":\"Processing mode of the EDI 276/277 request\"},\"payloadID\":{\"type\":\"string\",\"description\":\"ID of the EDI X12 request\"},\"timestamp\":{\"type\":\"string\",\"format\":\"date-time\",\"pattern\":\"[0-9]{4}-(0[1-9]|1[0-2])-(0[1-9]|[1-2][0-9]|3[0-1]) (2[0-3]|[01][0-9]):[0-5][0-9]\",\"description\":\"Timestamp the request was sent in\"},\"payload\":{\"type\":\"string\",\"description\":\"X12 EDI content or payload used for checking claim status\"}},\"type\":\"object\"},\"eligibiltyResponseModel\":{\"description\":\"This API is designed to assist those who request reviews (specialty care, treatment, admission) and those who respond to those requests using the 278 format.\",\"properties\":{\"payloadType\":{\"type\":\"string\",\"description\":\"Paylaod type of EDI X12 request\"},\"processingMode\":{\"type\":\"string\",\"description\":\"Processing mode of the EDI 276/277 request\"},\"payloadID\":{\"type\":\"string\",\"description\":\"ID of the EDI X12 request\"},\"senderID\":{\"type\":\"string\",\"description\":\"Sender ID of the EDI X12 request\"},\"receiverID\":{\"type\":\"string\",\"description\":\"Receiver ID of the EDI X12 request\"},\"timestamp\":{\"type\":\"string\",\"format\":\"date-time\",\"pattern\":\"[0-9]{4}-(0[1-9]|1[0-2])-(0[1-9]|[1-2][0-9]|3[0-1]) (2[0-3]|[01][0-9]):[0-5][0-9]\",\"description\":\"Timestamp the request was sent in\"},\"payload\":{\"type\":\"string\",\"description\":\"X12 EDI content or payload used for checking claim status\"}},\"type\":\"object\"}}}}");
        when(baseRepository.findOne("swaggerId", swaggerId, Swagger3VO.class)).thenReturn(swagger3VO) ;
        ArrayList<Swagger3VO> swaggerVersions = new ArrayList<>();
        swaggerVersions.add(swagger3VO);
        when(baseRepository.find("name", swaggerName, Swagger3VO.class)).thenReturn(swaggerVersions);

        Map swaggerInfo = swaggerBusiness.getSwaggerInfo(jsessionId, swaggerId, oas);

    }
}